notifications:
  email:
    on_success: never
    on_failure: change

sudo: required

services:
  - docker

stages:
  - prepare
  - build
  - name: deploy
    if: tag = true
    #if: branch = master OR tag = true

jobs:
  include:
    - stage: prepare
      script: make debian
      script: make clean
      script: make manylinux
    - stage: build
      script: make full-release
    - stage: deploy
      script: echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin && make full-push
